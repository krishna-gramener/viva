<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceViva</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        /* Custom CSS */
        .mic-btn.recording {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .question-container {
            margin-bottom: 2rem;
        }
        .transcript-box {
            min-height: 60px;
            margin-top: 10px;
        }
        .question-text {
            font-weight: 600;
            font-size: 1.1rem;
            color: #212529;
        }
        .spinner-container {
            display: none;
            margin-top: 10px;
        }
        .transcript-box {
            min-height: 100px;
            margin-bottom: 15px;
        }
        
        .spinner-container {
            display: none;
            margin-bottom: 10px;
        }
        
        .question-container {
            margin-bottom: 20px;
        }
        
        .interview-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .interview-card:hover {
            box-shadow: 0 10px 15px rgba(0,0,0,0.15);
        }
        
        .card-selected-indicator {
            margin-top: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="text-center mb-4">
                    <h1 class="mb-3">VoiceViva</h1>
                    <p class="lead mb-3">Your AI-powered interview companion that turns speech into perfect responses</p>
                    <div class="row justify-content-center mb-3">
                        <div class="col-md-6 mb-2">
                            <div class="input-group">
                                <label class="input-group-text" for="transcriptionService">Transcription Service</label>
                                <select class="form-select" id="transcriptionService">
                                    <option value="gemini" >Gemini</option>
                                    <option value="openai" selected>OpenAI </option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center mb-3">
                        <div class="col-md-6">
                            <div class="input-group">
                                <label class="input-group-text" for="microphoneSelect">Microphone</label>
                                <select class="form-select" id="microphoneSelect">
                                    <!-- Microphone options will be populated dynamically -->
                                </select>
                                <button type="button" class="btn btn-outline-secondary" id="refreshMics" title="Refresh microphone list">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="status" class="text-muted fst-italic">Ready to record</div>
                    
                    <!-- Interview Type Cards -->
                    <div class="row mt-4 mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 interview-card" data-index="0" style="cursor: pointer;">
                                <div class="card-body text-center">
                                    <i class="bi bi-cloud-download fs-1 mb-3 text-primary"></i>
                                    <h5 class="card-title">Data Sourcing</h5>
                                    <p class="card-text">Test your knowledge of Data Sourcing from the TDS Course.</p>
                                    <div class="card-selected-indicator text-primary" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> Selected
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 interview-card" data-index="1" style="cursor: pointer;">
                                <div class="card-body text-center">
                                    <i class="bi bi-chat-square-text fs-1 mb-3 text-success"></i>
                                    <h5 class="card-title">Large Language Models</h5>
                                    <p class="card-text">Test your knowledge of LLMs from the TDS Course.</p>
                                    <div class="card-selected-indicator text-success" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> Selected
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 interview-card" data-index="2" style="cursor: pointer;">
                                <div class="card-body text-center">
                                    <i class="bi bi-tools fs-1 mb-3 text-info"></i>
                                    <h5 class="card-title">Data Preparation</h5>
                                    <p class="card-text">Test your knowledge of Data Preparation from the TDS Course.</p>
                                    <div class="card-selected-indicator text-info" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> Selected
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GitHub Repository Input Section -->
                    <div class="card mt-3 mb-3">
                        <div class="card-header">
                            <button class="btn btn-link text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#githubRepoCollapse" aria-expanded="false" aria-controls="githubRepoCollapse">
                                <i class="bi bi-github me-2"></i> Use GitHub Repository
                            </button>
                        </div>
                        <div id="githubRepoCollapse" class="collapse">
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="githubRepoUrl" class="form-label">GitHub Repository URL</label>
                                    <input type="text" class="form-control" id="githubRepoUrl" placeholder="https://github.com/username/repository">
                                    <div class="form-text">Enter the full URL to the GitHub repository you want to analyze.</div>
                                </div>
                                <div class="mb-3">
                                    <label for="githubToken" class="form-label">GitHub Personal Access Token</label>
                                    <input type="password" class="form-control" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                                    <div class="form-text">Your token will be used only for this session and never stored.</div>
                                </div>

                                <button type="button" class="btn btn-primary" id="fetchRepoBtn">
                                    <i class="bi bi-download me-2"></i> Fetch Repository & Generate Questions
                                </button>
                                <div id="repo-status" class="mt-2 text-muted fst-italic"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Collapsible JSON Editor -->
                    <div class="card mt-3 mb-3">
                        <div class="card-header">
                            <button class="btn btn-link text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#jsonEditorCollapse" aria-expanded="false" aria-controls="jsonEditorCollapse">
                                <i class="bi bi-code-square me-2"></i> Edit Questions JSON
                            </button>
                        </div>
                        <div id="jsonEditorCollapse" class="collapse">
                            <div class="card-body">
                                <div class="mb-3">
                                    <textarea class="form-control" id="jsonEditor" rows="10" style="font-family: monospace;"></textarea>
                                </div>
                                <button type="button" class="btn btn-primary" id="runJsonBtn">
                                    <i class="bi bi-play-fill me-2"></i> Update Ques & Rubric
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Collapsible System Prompts Editor -->
                    <div class="card mt-3 mb-3">
                        <div class="card-header">
                            <button class="btn btn-link text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#systemPromptsCollapse" aria-expanded="false" aria-controls="systemPromptsCollapse">
                                <i class="bi bi-chat-square-text me-2"></i> Edit System Prompts
                            </button>
                        </div>
                        <div id="systemPromptsCollapse" class="collapse">
                            <div class="card-body">
                                <!-- Tabs for different system prompts -->
                                <ul class="nav nav-tabs" id="systemPromptTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="question-generation-tab" data-bs-toggle="tab" data-bs-target="#question-generation" type="button" role="tab" aria-controls="question-generation" aria-selected="true">Question Generation</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="evaluation-tab" data-bs-toggle="tab" data-bs-target="#evaluation" type="button" role="tab" aria-controls="evaluation" aria-selected="false">Evaluation</button>
                                    </li>
                                </ul>
                                
                                <!-- Tab content -->
                                <div class="tab-content mt-3" id="systemPromptTabContent">
                                    <!-- Question Generation System Prompt -->
                                    <div class="tab-pane fade show active" id="question-generation" role="tabpanel" aria-labelledby="question-generation-tab">
                                        <div class="mb-3">
                                            <label for="questionGenSystemPrompt" class="form-label">Question Generation System Prompt</label>
                                            <textarea class="form-control" id="questionGenSystemPrompt" rows="15" style="font-family: monospace;">You are an expert technical interviewer. You need to create interview questions based on the GitHub repository content provided. 
Create a set of 3-5 technical questions that would be appropriate for interviewing a developer who worked on this codebase.
Each question should test understanding of the code, architecture, or technologies used.

For each question, also create a rubric with 2-3 criteria to evaluate answers. Each criterion should have:
- A name
- A check description
- A scoring guide (0-2 scale)

Format your response as a valid JSON array following this structure:
[
  {
    "question": "Your technical question here?",
    "rubric": [
      {
        "name": "criterion_name",
        "check": "What to check for in the answer",
        "scoring": "0 = missing/incorrect, 1 = partial, 2 = complete and correct"
      },
      {...more criteria...}
    ]
  },
  {...more questions...}
]

Focus on key technical concepts, patterns, or technologies evident in the code. Make questions challenging but fair.</textarea>
                                        </div>
                                    </div>
                                    
                                    <!-- Evaluation System Prompt -->
                                    <div class="tab-pane fade" id="evaluation" role="tabpanel" aria-labelledby="evaluation-tab">
                                        <div class="mb-3">
                                            <label for="evaluationSystemPrompt" class="form-label">Evaluation System Prompt</label>
                                            <textarea class="form-control" id="evaluationSystemPrompt" rows="15" style="font-family: monospace;">You are an expert evaluator for interview answers. 
You will be given multiple questions, the user's answers, and rubrics with scoring criteria.
Evaluate each answer according to its rubric items and provide a score and reason.

Return your evaluation as HTML table rows with the following columns:
1. Name (include the question number and criteria name, e.g., "Q1_js_rendering")
2. Score (a number from 0-2)
3. Reason (brief explanation for the score)

Format your response as valid HTML table rows (<tr>, <td>) with color-coded cells using Bootstrap classes:
- For score 2: Add class="table-success" to the score <td> cell
- For score 1: Add class="table-warning" to the score <td> cell
- For score 0: Add class="table-danger" to the score <td> cell

At the end, include a summary row with the total score, maximum possible score, and percentage.
Make the summary row bold by using <strong> tags or class="fw-bold".
Color the summary score cell based on the percentage:
- If percentage >= 70%: class="table-success"
- If percentage between 40-70%: class="table-warning"
- If percentage < 40%: class="table-danger"

ONLY return <tr> and <td> elements. DO NOT include the <table>, <thead>, or <tbody> tags.</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card" id="questions-card">
                    <div class="card-header">Interview Questions</div>
                    <div class="card-body">
                        <form id="questionForm">
                            <!-- Questions will be dynamically loaded from ques.json -->
                            <div id="questions-container">
                                <div class="d-flex justify-content-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <span class="ms-2">Loading questions...</span>
                                </div>
                            </div>
                            
                            <div class="mt-4 text-center">
                                <button type="button" id="evaluateBtn" class="btn btn-success btn-lg">
                                    <i class="bi bi-check-circle me-2"></i>Evaluate Answers
                                </button>
                                <div id="evaluation-status" class="mt-2 text-muted fst-italic"></div>
                            </div>
                        </form>
                        
                        <!-- Results section -->
                        <div id="results-container" class="mt-4" style="display: none;">
                            <h4 class="mb-3">Evaluation Results</h4>
                            <div id="results-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js" type="module"></script>
</body>
</html>
